<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix –°–¢–û</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="container">
        <aside class="sidebar">
            <h2>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –ø–æ—Å–ª—É–≥</h2>
            <ul class="menu" id="categories-menu">
                <li class="menu-item active">–í–∏–±—Ä–∞–Ω—ñ –ø–æ—Å–ª—É–≥–∏</li>
                <!-- Categories will be loaded from CSV -->
            </ul>
        </aside>
        <main class="main-content">
            <div class="top-bar">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —É—Å–ª—É–≥...">
                    <div class="search-icon">üîç</div>
                </div>
                <div class="calculator">
                    <div class="calc-header">
                        <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Å–ª—É–≥</h3>
                        <div class="total">
                            –°—É–º–∞: <span id="totalPrice">0</span> ‚Ç¥
                        </div>
                    </div>
                    <div id="selectedCount">–í–∏–±—Ä–∞–Ω–æ –ø–æ—Å–ª—É–≥: <span>0</span></div>
                </div>
            </div>
            
            <div class="service-list-container">
                <ul class="service-list" data-category="selected" style="display: block;">
                    <h3>–í–∏–±—Ä–∞–Ω—ñ –ø–æ—Å–ª—É–≥–∏</h3>
                    <!-- Selected services will appear here -->
                </ul>
                <!-- Service lists will be loaded from CSV -->
            </div>
        </main>
    </div>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV
        async function loadServicesFromCSV() {
            try {
                const response = await fetch('services.csv');
                const data = await response.text();
                const rows = data.split('\n');
                const headers = rows[0].split(',');
                const services = [];
                const categories = new Set();

                // –ü–∞—Ä—Å–∏–º CSV –¥–∞–Ω–Ω—ã–µ
                for (let i = 1; i < rows.length; i++) {
                    if (rows[i].trim() === '') continue;
                    const values = rows[i].split(',');
                    const service = {
                        category: values[0],
                        name: values[1],
                        price: parseInt(values[2])
                    };
                    services.push(service);
                    categories.add(service.category);
                }

                // –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const categoriesMenu = document.getElementById('categories-menu');
                const firstMenuItem = categoriesMenu.firstElementChild; // –°–æ—Ö—Ä–∞–Ω—è–µ–º "–í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏"
                categoriesMenu.innerHTML = ''; // –û—á–∏—â–∞–µ–º –º–µ–Ω—é
                categoriesMenu.appendChild(firstMenuItem); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º "–í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏"

                categories.forEach(category => {
                    const li = document.createElement('li');
                    li.className = 'menu-item';
                    li.textContent = category;
                    categoriesMenu.appendChild(li);
                });

                // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–∫–∏ —É—Å–ª—É–≥
                const container = document.querySelector('.service-list-container');
                const selectedList = container.firstElementChild; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                container.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.appendChild(selectedList); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö

                categories.forEach(category => {
                    const ul = document.createElement('ul');
                    ul.className = 'service-list';
                    ul.setAttribute('data-category', category.toLowerCase().replace(/\s+/g, '-'));
                    
                    const h3 = document.createElement('h3');
                    h3.textContent = category;
                    ul.appendChild(h3);

                    // –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª—É–≥–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    services.filter(service => service.category === category)
                            .forEach(service => {
                                const li = document.createElement('li');
                                li.className = 'service-item';
                                li.innerHTML = `
                                    <label>
                                        <input type="checkbox">
                                        ${service.name}
                                        <span class="price">~ ${service.price} ‚Ç¥</span>
                                    </label>
                                `;
                                ul.appendChild(li);
                            });

                    container.appendChild(ul);
                });

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                initializeEventHandlers();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initializeEventHandlers() {
            const menuItems = document.querySelectorAll('.menu-item');
            const serviceLists = document.querySelectorAll('.service-list');
            const totalPriceElement = document.getElementById('totalPrice');
            const selectedCountElement = document.getElementById('selectedCount').querySelector('span');

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —É—Å–ª—É–≥
            function showServiceList(category) {
                serviceLists.forEach(list => {
                    if (list.getAttribute('data-category') !== 'selected') {
                        list.style.display = 'none';
                    }
                });

                const selectedList = document.querySelector(`.service-list[data-category="${category}"]`);
                if (selectedList && category !== 'selected') {
                    selectedList.style.display = 'block';
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
            function updateCalculator() {
                const selectedList = document.querySelector('.service-list[data-category="selected"]');
                const selectedItems = selectedList.querySelectorAll('.service-item');
                
                const totalPrice = Array.from(selectedItems).reduce((sum, item) => {
                    const priceText = item.querySelector('.price').textContent;
                    return sum + parseInt(priceText.replace(/[^0-9]/g, ''));
                }, 0);

                totalPriceElement.textContent = totalPrice.toLocaleString();
                selectedCountElement.textContent = selectedItems.length;
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–µ–Ω—é
            menuItems.forEach((item, index) => {
                item.addEventListener('click', () => {
                    menuItems.forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    const category = index === 0 ? 'selected' : 
                        item.textContent.toLowerCase().replace(/\s+/g, '-');
                    showServiceList(category);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchText = e.target.value.toLowerCase().trim();
                
                if (searchText === '') {
                    const activeCategory = document.querySelector('.menu-item.active');
                    if (activeCategory) {
                        activeCategory.click();
                    }
                    return;
                }

                serviceLists.forEach(list => {
                    if (list.getAttribute('data-category') !== 'selected') {
                        const items = list.querySelectorAll('.service-item');
                        let hasVisibleItems = false;

                        items.forEach(item => {
                            const text = item.textContent.toLowerCase();
                            const isVisible = text.includes(searchText);
                            item.style.display = isVisible ? 'flex' : 'none';
                            if (isVisible) hasVisibleItems = true;
                        });

                        list.style.display = hasVisibleItems ? 'block' : 'none';
                    }
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
            document.addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    const selectedList = document.querySelector('.service-list[data-category="selected"]');
                    const serviceItem = e.target.closest('.service-item');
                    const itemText = serviceItem.querySelector('label').textContent.trim();
                    
                    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã
                    document.querySelectorAll('.service-item input[type="checkbox"]').forEach(checkbox => {
                        const checkboxText = checkbox.closest('label').textContent.trim();
                        if (checkboxText === itemText) {
                            checkbox.checked = e.target.checked;
                        }
                    });
                    
                    if (e.target.checked) {
                        const existingItem = Array.from(selectedList.querySelectorAll('.service-item'))
                            .find(item => item.querySelector('label').textContent.trim() === itemText);
                        
                        if (!existingItem) {
                            const clonedItem = serviceItem.cloneNode(true);
                            clonedItem.querySelector('input[type="checkbox"]').checked = true;
                            selectedList.appendChild(clonedItem);
                        }
                    } else {
                        const itemInSelected = Array.from(selectedList.querySelectorAll('.service-item'))
                            .find(item => item.querySelector('label').textContent.trim() === itemText);
                        
                        if (itemInSelected) {
                            itemInSelected.remove();
                        }
                    }

                    updateCalculator();
                }
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
            updateCalculator();
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadServicesFromCSV);
    </script>
</body>

</html>
